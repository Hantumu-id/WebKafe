<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bintang Karang - Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['SF Pro Display', 'Inter', 'sans-serif'],
                    },
                    colors: {
                        patrick: {
                            pink: '#FFC0CB',      
                            darkPink: '#F06292',  
                            teal: '#4DB6AC',      
                            lightTeal: '#B2DFDB',     
                            purple: '#D1C4E9',    
                            yellow: '#FFF9C4',
                        }
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #ffffff; -webkit-font-smoothing: antialiased; }
        
        /* Glass Utility */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .input-glass:focus {
            background: white;
            border-color: #4DB6AC;
            box-shadow: 0 0 0 4px rgba(77, 182, 172, 0.1);
        }
        
        /* Sticky Header for Menu Categories */
        .category-header {
            position: sticky;
            top: 74px; /* Adjust based on main header height */
            z-index: 30;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(8px);
            padding-top: 1rem;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 bg-gray-50">

    <!-- === SCREEN 1: CHECK-IN (LOGIN) === -->
    <div id="checkin-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-6 bg-white transition-transform duration-700 ease-in-out">
        
        <div class="mb-8 relative animate-float">
            <div class="w-24 h-24 bg-gradient-to-tr from-patrick-pink to-patrick-purple rounded-full blur-2xl absolute inset-0 opacity-50"></div>
            <div class="w-24 h-24 bg-white/40 backdrop-blur-xl rounded-3xl shadow-xl border border-white flex items-center justify-center relative z-10">
                <i data-lucide="coffee" class="w-10 h-10 text-patrick-darkPink"></i>
            </div>
        </div>

        <div class="glass-card w-full max-w-sm rounded-[2rem] p-8">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold text-gray-900">Selamat Datang!</h1>
                <p class="text-gray-500 text-sm mt-1">Check-in meja dulu ya.</p>
            </div>

            <div class="space-y-5">
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Nama Panggilan</label>
                    <div class="relative">
                        <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                        <input type="text" id="input-name" placeholder="Contoh: Patrick" class="input-glass w-full py-4 pl-12 pr-4 rounded-2xl text-gray-900 font-medium outline-none">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-1">Nomor Meja</label>
                    <div class="relative">
                        <i data-lucide="map-pin" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                        <select id="input-table" class="input-glass w-full py-4 pl-12 pr-4 rounded-2xl text-gray-900 font-medium outline-none appearance-none bg-transparent cursor-pointer">
                            <option value="" disabled selected>Pilih Meja...</option>
                            <option value="Meja 01">Meja 01</option>
                            <option value="Meja 02">Meja 02</option>
                            <option value="Meja 03">Meja 03</option>
                            <option value="Meja 04">Meja 04</option>
                            <option value="Takeaway">Bungkus (Takeaway)</option>
                        </select>
                        <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <button onclick="submitCheckIn()" class="w-full bg-gray-900 text-white py-4 rounded-2xl font-bold text-lg hover:bg-patrick-teal hover:shadow-lg transition-all duration-300 mt-4 flex items-center justify-center gap-2">
                    <span>Lihat Menu</span>
                </button>
            </div>
        </div>
    </div>


    <!-- === SCREEN 2: MAIN APP (MENU) === -->
    <div id="main-app" class="hidden opacity-0 transition-opacity duration-500 pb-32">
        
        <!-- Header -->
        <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md px-6 py-4 flex justify-between items-center shadow-sm border-b border-gray-100">
            <div>
                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Hai, <span id="display-name">Guest</span></p>
                <div class="flex items-center gap-1.5">
                    <div class="w-2 h-2 rounded-full bg-patrick-teal"></div>
                    <span class="text-sm font-bold text-gray-900" id="display-table">...</span>
                </div>
            </div>
            <!-- Cart Icon -->
            <div onclick="openCart()" class="relative cursor-pointer w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center hover:bg-patrick-pink hover:text-white transition-colors group">
                <i data-lucide="shopping-bag" class="w-5 h-5 text-gray-700 group-hover:text-white transition-colors"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden border-2 border-white">0</span>
            </div>
        </header>

        <!-- Menu Section -->
        <main class="px-4 mt-4 max-w-lg mx-auto animate-slide-up">
            <!-- Promo Banner -->
            <div class="w-full h-32 bg-gradient-to-r from-patrick-teal to-blue-200 rounded-3xl mb-6 relative overflow-hidden flex items-center px-6 shadow-sm">
                <div class="text-white relative z-10">
                    <h2 class="font-bold text-xl mb-1">Diskon 20%</h2>
                    <p class="text-xs opacity-90">Semua menu matcha hari ini!</p>
                </div>
                <div class="absolute right-[-20px] bottom-[-40px] w-32 h-32 bg-white/20 rounded-full blur-2xl"></div>
            </div>
            
            <!-- List Menu (Diisi Javascript) -->
            <div id="menu-container" class="space-y-2">
                <!-- Categories and items will be injected here -->
            </div>
        </main>
    </div>


    <!-- === CART MODAL === -->
    <div id="cart-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity" onclick="closeCart()"></div>
        <div class="absolute bottom-0 left-0 w-full bg-white rounded-t-[2.5rem] p-6 transition-transform duration-300 transform translate-y-full flex flex-col max-h-[85vh]" id="cart-panel">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6 shrink-0"></div>
            
            <div class="flex justify-between items-center mb-6 shrink-0">
                <h3 class="text-xl font-bold text-gray-900">Pesanan Kamu</h3>
                <span class="text-xs bg-gray-100 px-3 py-1 rounded-full text-gray-500 font-medium" id="cart-table-display">Meja ?</span>
            </div>
            
            <div id="cart-items" class="overflow-y-auto mb-4 space-y-4 flex-1 pr-2">
                <!-- Cart items here -->
            </div>

            <div class="pt-4 border-t border-gray-100 shrink-0">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-500 text-sm">Total</span>
                    <span id="cart-total" class="font-bold text-xl text-gray-900">Rp 0</span>
                </div>
                <button onclick="submitOrder()" id="btn-checkout" class="w-full py-4 bg-gray-900 text-white rounded-2xl font-bold text-lg hover:bg-patrick-pink transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                    <span>Kirim ke Dapur</span>
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md text-gray-800 px-6 py-4 rounded-2xl text-sm font-bold shadow-2xl transform -translate-y-32 transition-transform duration-500 z-[70] flex items-center gap-3 border border-gray-100">
        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600"><i data-lucide="check" class="w-4 h-4"></i></div>
        <div><p>Pesanan Terkirim!</p></div>
    </div>

    <!-- FIREBASE SETUP -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // GANTI CONFIG FIREBASE DI SINI
        const firebaseConfig = {
  apiKey: "AIzaSyCfN6nDGb7cLY21n0tl1dD0h8boSqsSI9k",
  authDomain: "kafegue-7c39d.firebaseapp.com",
  projectId: "kafegue-7c39d",
  storageBucket: "kafegue-7c39d.firebasestorage.app",
  messagingSenderId: "713529737766",
  appId: "1:713529737766:web:26c45dfe58f7137ffb9ce7",
  measurementId: "G-MD7SPPGV1K"
};

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            window.db = db;
            window.collection = collection;
            window.addDoc = addDoc;
            window.serverTimestamp = serverTimestamp;
        } catch (e) { console.error("Firebase config error"); }
    </script>

    <script>
        // --- DATA MENU LENGKAP (35 ITEM) ---
        const menuData = [
            // KOPI (15 Items)
            { id: 1, name: "Es Kopi Susu Patrick", price: 25000, desc: "Gula aren + hint stroberi", cat: "coffee" },
            { id: 2, name: "Americano Karang", price: 22000, desc: "Hitam pekat menyegarkan", cat: "coffee" },
            { id: 3, name: "Cappuccino Awan", price: 28000, desc: "Foam tebal lembut", cat: "coffee" },
            { id: 4, name: "Caffe Latte", price: 28000, desc: "Susu creamy pilihan", cat: "coffee" },
            { id: 5, name: "Caramel Macchiato", price: 32000, desc: "Saus karamel legit", cat: "coffee" },
            { id: 6, name: "Hazelnut Latte", price: 30000, desc: "Aroma kacang hazel", cat: "coffee" },
            { id: 7, name: "Vanilla Latte", price: 30000, desc: "Klasik vanila manis", cat: "coffee" },
            { id: 8, name: "Mochaccino", price: 30000, desc: "Cokelat campur kopi", cat: "coffee" },
            { id: 9, name: "Flat White", price: 28000, desc: "Microfoam halus", cat: "coffee" },
            { id: 10, name: "Piccolo", price: 25000, desc: "Kecil tapi kuat", cat: "coffee" },
            { id: 11, name: "Affogato", price: 35000, desc: "Es krim siram espresso", cat: "coffee" },
            { id: 12, name: "Cold Brew 12H", price: 30000, desc: "Seduh dingin semalam", cat: "coffee" },
            { id: 13, name: "Kopi Charcoal", price: 32000, desc: "Hitam arang detox", cat: "coffee" },
            { id: 14, name: "Rose Latte", price: 32000, desc: "Aroma mawar elegan", cat: "coffee" },
            { id: 15, name: "Espresso Single", price: 18000, desc: "Shot murni", cat: "coffee" },

            // NON-KOPI (15 Items)
            { id: 16, name: "Matcha Bikini", price: 30000, desc: "Teh hijau Jepang asli", cat: "non-coffee" },
            { id: 17, name: "Red Velvet Latte", price: 28000, desc: "Rasa kue cair", cat: "non-coffee" },
            { id: 18, name: "Belgian Chocolate", price: 28000, desc: "Cokelat pekat", cat: "non-coffee" },
            { id: 19, name: "Taro Ungu", price: 28000, desc: "Ubi ungu manis", cat: "non-coffee" },
            { id: 20, name: "Thai Tea Orange", price: 22000, desc: "Teh Thailand otentik", cat: "non-coffee" },
            { id: 21, name: "Hojicha Roasted", price: 30000, desc: "Teh panggang smoky", cat: "non-coffee" },
            { id: 22, name: "Lemon Tea", price: 18000, desc: "Perasan lemon asli", cat: "non-coffee" },
            { id: 23, name: "Lychee Tea", price: 22000, desc: "Teh buah leci", cat: "non-coffee" },
            { id: 24, name: "Peach Tea", price: 22000, desc: "Wangi buah persik", cat: "non-coffee" },
            { id: 25, name: "Earl Grey Milk", price: 25000, desc: "Teh susu bergamot", cat: "non-coffee" },
            { id: 26, name: "Chamomile", price: 20000, desc: "Teh bunga tenang", cat: "non-coffee" },
            { id: 27, name: "Peppermint", price: 20000, desc: "Semriwing dingin", cat: "non-coffee" },
            { id: 28, name: "Berry Smoothie", price: 35000, desc: "Campuran berry segar", cat: "non-coffee" },
            { id: 29, name: "Mango Smoothie", price: 35000, desc: "Mangga harum manis", cat: "non-coffee" },
            { id: 30, name: "Mineral Water", price: 10000, desc: "Botol premium", cat: "non-coffee" },

            // PASTRY (5 Items)
            { id: 31, name: "Butter Croissant", price: 22000, desc: "Renyah bermentega", cat: "pastry" },
            { id: 32, name: "Pain au Chocolat", price: 25000, desc: "Isi cokelat lumer", cat: "pastry" },
            { id: 33, name: "Cinnamon Roll", price: 25000, desc: "Kayu manis glaze", cat: "pastry" },
            { id: 34, name: "Cheese Cake", price: 35000, desc: "Keju lembut", cat: "pastry" },
            { id: 35, name: "Almond Croissant", price: 28000, desc: "Topping almond", cat: "pastry" },
        ];

        let cart = [];
        let customerInfo = { name: '', table: '' };

        // --- RENDER MENU PER KATEGORI ---
        function renderMenu() {
            const container = document.getElementById('menu-container');
            const categories = [
                { id: 'coffee', title: 'Kopi Karang', icon: 'coffee' },
                { id: 'non-coffee', title: 'Penyegar Laut', icon: 'glass-water' },
                { id: 'pastry', title: 'Kudapan Manis', icon: 'croissant' }
            ];

            categories.forEach(cat => {
                // Buat Header Kategori
                const header = document.createElement('div');
                header.className = 'category-header flex items-center gap-2 text-gray-900 border-b border-gray-100';
                header.innerHTML = `
                    <i data-lucide="${cat.icon}" class="w-5 h-5 text-patrick-teal"></i>
                    <h3 class="font-bold text-lg">${cat.title}</h3>
                `;
                container.appendChild(header);

                // Filter Items
                const items = menuData.filter(m => m.cat === cat.id);
                
                // Render Items
                items.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'flex items-center justify-between p-4 bg-white rounded-3xl shadow-sm border border-gray-100 hover:border-patrick-teal/30 transition-all mb-3';
                    
                    let iconBg = 'bg-gray-100';
                    let iconColor = 'text-gray-500';
                    if(cat.id === 'coffee') { iconBg = 'bg-pink-50'; iconColor = 'text-patrick-darkPink'; }
                    if(cat.id === 'non-coffee') { iconBg = 'bg-teal-50'; iconColor = 'text-patrick-teal'; }
                    if(cat.id === 'pastry') { iconBg = 'bg-yellow-50'; iconColor = 'text-yellow-600'; }

                    el.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-2xl ${iconBg} flex items-center justify-center ${iconColor} font-bold text-sm shrink-0">
                                ${item.name.charAt(0)}
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm leading-tight">${item.name}</h4>
                                <p class="text-[10px] text-gray-400 mb-0.5">${item.desc}</p>
                                <p class="text-sm font-semibold text-gray-700">Rp ${item.price.toLocaleString()}</p>
                            </div>
                        </div>
                        <button onclick="addToCart(${item.id})" class="w-8 h-8 rounded-full bg-gray-50 text-gray-900 flex items-center justify-center hover:bg-black hover:text-white transition-all active:scale-90 shadow-sm border border-gray-200">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                        </button>
                    `;
                    container.appendChild(el);
                });
            });
            lucide.createIcons();
        }

        // --- CHECK-IN LOGIC ---
        function submitCheckIn() {
            const nameInput = document.getElementById('input-name');
            const tableInput = document.getElementById('input-table');
            
            if(!nameInput.value.trim()) {
                nameInput.focus();
                return;
            }
            if(!tableInput.value) {
                tableInput.focus();
                return;
            }

            customerInfo.name = nameInput.value;
            customerInfo.table = tableInput.value;

            document.getElementById('display-name').innerText = customerInfo.name;
            document.getElementById('display-table').innerText = customerInfo.table;
            document.getElementById('cart-table-display').innerText = customerInfo.table;

            const screen1 = document.getElementById('checkin-screen');
            const screen2 = document.getElementById('main-app');

            screen1.style.transform = 'translateY(-100%)';
            screen1.style.opacity = '0';
            
            screen2.classList.remove('hidden');
            setTimeout(() => {
                screen2.classList.remove('opacity-0');
            }, 100);
            setTimeout(() => {
                screen1.classList.add('hidden');
            }, 700);
        }

        // --- CART LOGIC ---
        function addToCart(id) {
            const item = menuData.find(i => i.id === id);
            const existing = cart.find(i => i.id === id);
            if(existing) existing.qty++;
            else cart.push({...item, qty: 1});
            
            updateCartUI();
            const badge = document.getElementById('cart-count');
            badge.classList.add('scale-150');
            setTimeout(() => badge.classList.remove('scale-150'), 200);
        }

        function updateCartUI() {
            const badge = document.getElementById('cart-count');
            const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
            if(totalQty > 0) {
                badge.innerText = totalQty;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function openCart() {
            document.getElementById('cart-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('cart-panel').classList.remove('translate-y-full'), 10);
            renderCartItems();
        }

        function closeCart() {
            document.getElementById('cart-panel').classList.add('translate-y-full');
            setTimeout(() => document.getElementById('cart-modal').classList.add('hidden'), 300);
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items');
            container.innerHTML = '';
            let total = 0;

            if(cart.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-400 py-10"><p>Keranjang kosong</p></div>`;
                document.getElementById('btn-checkout').disabled = true;
                document.getElementById('btn-checkout').classList.add('opacity-50');
            } else {
                document.getElementById('btn-checkout').disabled = false;
                document.getElementById('btn-checkout').classList.remove('opacity-50');
                
                cart.forEach((item, index) => {
                    total += item.price * item.qty;
                    const el = document.createElement('div');
                    el.className = 'flex justify-between items-center bg-gray-50 p-3 rounded-2xl mb-2';
                    el.innerHTML = `
                        <div><span class="font-bold text-sm block">${item.name}</span><div class="text-xs text-gray-500">Rp ${item.price.toLocaleString()}</div></div>
                        <div class="flex items-center gap-3 bg-white px-2 py-1 rounded-full border border-gray-200">
                            <button onclick="changeQty(${index}, -1)" class="font-bold text-gray-600">-</button>
                            <span class="text-sm font-bold w-4 text-center">${item.qty}</span>
                            <button onclick="changeQty(${index}, 1)" class="font-bold text-gray-600">+</button>
                        </div>
                    `;
                    container.appendChild(el);
                });
            }
            document.getElementById('cart-total').innerText = 'Rp ' + total.toLocaleString();
        }

        function changeQty(index, delta) {
            cart[index].qty += delta;
            if(cart[index].qty <= 0) cart.splice(index, 1);
            updateCartUI();
            renderCartItems();
        }

        async function submitOrder() {
            if(cart.length === 0) return;
            const btn = document.getElementById('btn-checkout');
            const originalText = btn.innerHTML;
            btn.innerHTML = `Mengirim...`;
            btn.disabled = true;

            try {
                await window.addDoc(window.collection(window.db, "orders"), {
                    customerName: customerInfo.name,
                    tableNumber: customerInfo.table,
                    items: cart,
                    status: 'pending',
                    totalPrice: cart.reduce((acc, item) => acc + (item.price * item.qty), 0),
                    createdAt: window.serverTimestamp()
                });
                cart = [];
                updateCartUI();
                closeCart();
                const toast = document.getElementById('toast');
                toast.classList.remove('-translate-y-32');
                setTimeout(() => toast.classList.add('-translate-y-32'), 4000);
            } catch (e) { alert("Gagal kirim order."); } 
            finally { btn.innerHTML = originalText; btn.disabled = false; }
        }

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            renderMenu();
            lucide.createIcons();
        });
        // Make functions global
        window.submitCheckIn = submitCheckIn;
        window.addToCart = addToCart;
        window.openCart = openCart;
        window.closeCart = closeCart;
        window.changeQty = changeQty;
        window.submitOrder = submitOrder;
    </script>
</body>
</html>


